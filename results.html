<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Latest Racing Results | Smart Racecards</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="global.css" />
</head>
<body>
  <h1>Latest Racing Results</h1>
  <div id="results"></div>
  <!-- Put your script after your HTML -->
  <script>
    fetch('/api/results')
      .then(res => res.json())
      .then(data => {
        const resultsDiv = document.getElementById('results');
        if (!data || !data.results || !data.results.length) {
          resultsDiv.innerHTML = '<p>No results yet. Please check back later.</p>';
          return;
        }
        resultsDiv.innerHTML = data.results.map(race => {
          const top = (race.runners || [])
            .filter(r => r.position && Number(r.position) > 0)
            .sort((a, b) => Number(a.position) - Number(b.position));
          const winner = top[0] ? `<b>Winner:</b> ${top[0].horse} <span style="color:#888;">(SP: ${top[0].sp})</span>` : '';
          const placed = top[1] ? ` <b>2nd:</b> ${top[1].horse}` : '';
          const third = top[2] ? ` <b>3rd:</b> ${top[2].horse}` : '';
          return `
            <div class="race-result">
              <h2>${race.off} - ${race.course}</h2>
              <div>${race.race_name || ''}</div>
              <div>${winner}${placed}${third}</div>
            </div>
          `;
        }).join('');
      })
      .catch(() => {
        document.getElementById('results').innerHTML = '<p>Error loading results.</p>';
      });
  </script>
</body>
</html>
